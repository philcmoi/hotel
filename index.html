<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Réservation Hôtel - Calendrier</title>
    <style>

  

/* *********************************** CSS ***************************************************** */

/* ********************************************************************************************* */ 
    
  
  * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background-color: #f5f5f5;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        top: 0px;
        padding: 0px;
      }

      header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        text-align: center;
        border-radius: 10px;
        margin-bottom: 2rem;
      }

      .calendar-section {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .calendar-nav button {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        margin: 0 5px;
      }

      .calendar-nav button:hover {
        background: #5a6fd8;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #ddd;
        border: 1px solid #ddd;
      }

      .calendar-day-header {
        background: #667eea;
        color: white;
        padding: 10px;
        text-align: center;
        font-weight: bold;
      }

      .calendar-day {
        background: white;
        padding: 10px;
        min-height: 100px;
        border: 1px solid #eee;
      }

      .calendar-day.other-month {
        background: #f9f9f9;
        color: #999;
      }

      .calendar-day.today {
        background: #e3f2fd;
      }

      .reservation {
        background: #4caf50;
        color: white;
        padding: 2px 5px;
        margin: 2px 0;
        border-radius: 3px;
        font-size: 0.8em;
        cursor: pointer;
      }

      .reservation.chambre-1 {
        background: #4caf50;
      }
      .reservation.chambre-2 {
        background: #2196f3;
      }
      .reservation.chambre-3 {
        background: #ff9800;
      }

      .booking-form {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1em;
      }

      .chambre-selection {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .chambre-card {
        border: 2px solid #ddd;
        padding: 1rem;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .chambre-card.selected {
        border-color: #667eea;
        background: #f0f4ff;
      }

      .chambre-card.unavailable {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        transition: background 0.3s ease;
      }

      .btn:hover {
        background: #5a6fd8;
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .availability-result {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 5px;
        display: none;
      }

      .availability-result.available {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .availability-result.unavailable {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        max-width: 500px;
        width: 90%;
      }
    
/*********************************** CSS CARROUSEL *******************************************/

/********************************************************************************************/
    
* {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .carousel-container {
        max-width: 800px;
        width: 100%;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        padding: 10px;
        position: relative;
      }

      .carousel-title {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2rem;
        font-weight: 300;
      }

      .carousel {
        position: relative;
        width: 100%;
        height: 400px;
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .carousel-track {
        display: flex;
        height: 100%;
        transition: transform 0.5s ease-in-out;
      }

      .carousel-slide {
        min-width: 100%;
        height: 100%;
        position: relative;
      }

      .carousel-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .slide-content {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        color: white;
        padding: 30px 20px 20px;
        transform: translateY(0);
        transition: transform 0.3s ease;
      }

      .carousel-slide:hover .slide-content {
        transform: translateY(0);
      }

      .slide-title {
        font-size: 1.5rem;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .slide-description {
        font-size: 1rem;
        opacity: 0.9;
      }

      /* Navigation */
      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        color: #333;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 10;
      }

      .carousel-btn:hover {
        background: white;
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .carousel-btn.prev {
        left: 20px;
      }

      .carousel-btn.next {
        right: 20px;
      }

      /* Indicateurs */
      .carousel-indicators {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 25px;
      }

      .indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      }

      .indicator.active {
        background: #667eea;
        transform: scale(1.2);
      }

      .indicator:hover {
        background: #999;
        transform: scale(1.1);
      }

      /* Compteur */
      .carousel-counter {
        text-align: center;
        margin-top: 15px;
        color: #666;
        font-size: 0.9rem;
      }

      /* Animation d'entrée */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(1.05);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .carousel-slide.active {
        animation: fadeIn 0.5s ease;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .carousel {
          height: 300px;
        }

        .carousel-container {
          padding: 10px;
          top: 0px;
        }

        .carousel-title {
          font-size: 1.5rem;
        }

        .slide-title {
          font-size: 1.2rem;
        }

        .carousel-btn {
          width: 40px;
          height: 40px;
          font-size: 1.2rem;
        }
      }

      @media (max-width: 480px) {
        .carousel {
          height: 250px;
        }

        .slide-content {
          padding: 20px 15px 15px;
        }

        .slide-title {
          font-size: 1rem;
        }

        .slide-description {
          font-size: 0.8rem;
        }
      }

</style>
  </head>
  <!-- **************************************   FIN CSS   ****************************************   

 *****************************************   DEBUT HTML   *************************************** -->


  <body>

    <div class="container">
      <header>
        <h1>Réservation Hôtel</h1>
        <!--<p>Calendrier de disponibilité des chambres</p>-->
      </header>

<!-- *****************************      CAROUSSEL HTML      *********************************** -->

<!-- ****************************************************************************************** -->
      
    <div class="carousel-container">
        <h1 class="carousel-title">Galerie Photos</h1>

        <div class="carousel">
          <div class="carousel-track">
            <!-- Slide 1 -->
            <div class="carousel-slide active">
              <img
                src="https://picsum.photos/800/400?random=1"
                alt="Paysage montagne"
                class="carousel-image"
              />
              <div class="slide-content">
                <h3 class="slide-title">Paysage Montagneux</h3>
                <p class="slide-description">
                  Découvrez la beauté des sommets enneigés
                </p>
              </div>
            </div>

            <!-- Slide 2 -->
            <div class="carousel-slide">
              <img
                src="https://picsum.photos/800/400?random=2"
                alt="Plage tropicale"
                class="carousel-image"
              />
              <div class="slide-content">
                <h3 class="slide-title">Plage Paradisiaque</h3>
                <p class="slide-description">
                  Sable fin et eaux turquoises vous attendent
                </p>
              </div>
            </div>

            <!-- Slide 3 -->
            <div class="carousel-slide">
              <img
                src="https://picsum.photos/800/400?random=3"
                alt="Forêt verdoyante"
                class="carousel-image"
              />
              <div class="slide-content">
                <h3 class="slide-title">Forêt Mystérieuse</h3>
                <p class="slide-description">
                  Promenade au cœur de la nature sauvage
                </p>
              </div>
            </div>

            <!-- Slide 4 -->
            <div class="carousel-slide">
              <img
                src="https://picsum.photos/800/400?random=4"
                alt="Ville la nuit"
                class="carousel-image"
              />
              <div class="slide-content">
                <h3 class="slide-title">Ville Nocturne</h3>
                <p class="slide-description">
                  L'énergie vibrante des métropoles modernes
                </p>
              </div>
            </div>

            <!-- Slide 5 -->
            <div class="carousel-slide">
              <img
                src="https://picsum.photos/800/400?random=5"
                alt="Desert"
                class="carousel-image"
              />
              <div class="slide-content">
                <h3 class="slide-title">Désert Infini</h3>
                <p class="slide-description">
                  L'immensité silencieuse des dunes de sable
                </p>
              </div>
            </div>
          </div>

          <!-- Boutons de navigation -->
          <button class="carousel-btn prev" aria-label="Image précédente">
            ❮
          </button>
          <button class="carousel-btn next" aria-label="Image suivante">
            ❯
          </button>
        </div>

        <!-- Indicateurs -->
        <div class="carousel-indicators">
          <button
            class="indicator active"
            data-slide="0"
            aria-label="Aller à l'image 1"
          ></button>
          <button
            class="indicator"
            data-slide="1"
            aria-label="Aller à l'image 2"
          ></button>
          <button
            class="indicator"
            data-slide="2"
            aria-label="Aller à l'image 3"
          ></button>
          <button
            class="indicator"
            data-slide="3"
            aria-label="Aller à l'image 4"
          ></button>
          <button
            class="indicator"
            data-slide="4"
            aria-label="Aller à l'image 5"
          ></button>
        </div>
    
        <!-- Compteur -->
        <div class="carousel-counter">
          <span id="current-slide">1</span> / <span id="total-slides">5</span>
        </div>
      </div>
    


      <!-- ******************************** FORMULAIRE  ***************************************** -->
      <!-- ************************************************************************************** -->
  

    <section class="booking-form">
        <h2>Recherche chambres disponible</h2>
        <form id="reservation-form">
          <div class="form-group">
            <label>Dates de séjour</label>
            <div style="display: flex; gap: 10px">
              <input type="date" id="date-arrivee" required />
              <input type="date" id="date-depart" required />
            </div>
          </div>

          <div class="form-group">
            <label>Vérifier la disponibilité</label>
            <button type="button" onclick="checkAvailability()" class="btn">
              Vérifier
            </button>
          </div>

          <div id="availability-result" class="availability-result"></div>

          <div class="form-group">
            <label>Chambres disponibles</label>
            <div id="chambre-selection" class="chambre-selection">
              <!-- Les chambres seront chargées ici -->
            </div>
          </div>

          <div class="form-group">
            <button type="button" onclick="reserver()" class="btn">
              Cliquer ici pour réserver
            </button>
          </div>

          
<!-- **************************      DEBUT JAVASCRIPT  ****************************************** -->
<!-- ******************************************************************************************* -->
  <script>

/******************************************  CAROUSEL JAVASCRIPT  ******************************************/

/*************************************************************************************************/      
    class Carousel {
          constructor() {
            this.currentSlide = 0;
            this.totalSlides = 5;
            this.track = document.querySelector(".carousel-track");
            this.slides = document.querySelectorAll(".carousel-slide");
            this.indicators = document.querySelectorAll(".indicator");
            this.autoPlayInterval = null;

            this.init();
          }

          init() {
            // Événements boutons
            document
              .querySelector(".carousel-btn.prev")
              .addEventListener("click", () => {
                this.prevSlide();
              });

            document
              .querySelector(".carousel-btn.next")
              .addEventListener("click", () => {
                this.nextSlide();
              });

            // Événements indicateurs
            this.indicators.forEach((indicator, index) => {
              indicator.addEventListener("click", () => {
                this.goToSlide(index);
              });
            });

            // Navigation au clavier
            document.addEventListener("keydown", (e) => {
              if (e.key === "ArrowLeft") this.prevSlide();
              if (e.key === "ArrowRight") this.nextSlide();
            });

            // Autoplay
            this.startAutoPlay();

            // Pause autoplay au hover
            document
              .querySelector(".carousel")
              .addEventListener("mouseenter", () => {
                this.stopAutoPlay();
              });

            document
              .querySelector(".carousel")
              .addEventListener("mouseleave", () => {
                this.startAutoPlay();
              });

            this.updateCounter();
          }

          updateSlide() {
            // Déplacement du track
            this.track.style.transform = `translateX(-${
              this.currentSlide * 100
            }%)`;

            // Mise à jour des indicateurs
            this.indicators.forEach((indicator, index) => {
              indicator.classList.toggle("active", index === this.currentSlide);
            });

            // Mise à jour des classes active pour les slides
            this.slides.forEach((slide, index) => {
              slide.classList.toggle("active", index === this.currentSlide);
            });

            this.updateCounter();
          }

          nextSlide() {
            this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
            this.updateSlide();
          }

          prevSlide() {
            this.currentSlide =
              (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
            this.updateSlide();
          }

          goToSlide(index) {
            this.currentSlide = index;
            this.updateSlide();
          }

          updateCounter() {
            document.getElementById("current-slide").textContent =
              this.currentSlide + 1;
            document.getElementById("total-slides").textContent =
              this.totalSlides;
          }

          startAutoPlay() {
            this.stopAutoPlay(); // Arrêter l'ancien intervalle
            this.autoPlayInterval = setInterval(() => {
              this.nextSlide();
            }, 5000); // Change toutes les 5 secondes
          }

          stopAutoPlay() {
            if (this.autoPlayInterval) {
              clearInterval(this.autoPlayInterval);
              this.autoPlayInterval = null;
            }
          }
        }

        // Initialisation du carrousel
        document.addEventListener("DOMContentLoaded", () => {
          new Carousel();
        });

        // Gestion du swipe sur mobile
        let touchStartX = 0;
        let touchEndX = 0;
        const carousel = document.querySelector(".carousel");

        carousel.addEventListener("touchstart", (e) => {
          touchStartX = e.changedTouches[0].screenX;
        });

        carousel.addEventListener("touchend", (e) => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        });

        function handleSwipe() {
          const swipeThreshold = 50;
          const diff = touchStartX - touchEndX;

          if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
              // Swipe gauche - image suivante
              document.querySelector(".carousel-btn.next").click();
            } else {
              // Swipe droite - image précédente
              document.querySelector(".carousel-btn.prev").click();
            }
          }
        }

/* ********************************** FIN CARROUSEL JAVASCRIPT ******************************************/

/* **********************************DEBUT TRAITEMENT RESERVATION ************************************/        
      

  class ReservationCalendar {
        constructor() {
          this.currentDate = new Date();
          this.selectedChambres = [];
          this.chambres = [];
          this.init();
        }

        init() {
          this.loadChambres();
          this.loadReservations();
          this.setupEventListeners();
        }

        loadChambres() {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'reservation.php?action=get_chambres', true);
    xhr.onreadystatechange = () => {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                try {
                    const response = JSON.parse(xhr.responseText);
                    if (response.error) {
                        console.error("Erreur serveur:", response.error);
                        return;
                    }
                    this.chambres = response;
                    this.renderChambreSelection();
                } catch (error) {
                    console.error("Erreur parsing JSON:", error);
                    console.log("Réponse brute:", xhr.responseText);
                }
            } else {
                console.error("Erreur HTTP:", xhr.status);
            }
        }
    };
    xhr.onerror = () => {
        console.error("Erreur réseau lors du chargement des chambres");
    };
    xhr.send();
}

loadReservations() {
    const month = this.currentDate.getMonth() + 1;
    const year = this.currentDate.getFullYear();
    
    const xhr = new XMLHttpRequest();
    xhr.open('GET', `reservation.php?action=get_reservations&month=${month}&year=${year}`, true);
    xhr.onreadystatechange = () => {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                try {
                    const response = JSON.parse(xhr.responseText);
                    if (response.error) {
                        console.error("Erreur serveur:", response.error);
                        return;
                    }
                    this.displayReservations(response);
                } catch (error) {
                    console.error("Erreur parsing JSON:", error);
                    console.log("Réponse brute:", xhr.responseText);
                }
            } else {
                console.error("Erreur HTTP:", xhr.status);
            }
        }
    };
    xhr.onerror = () => {
        console.error("Erreur réseau lors du chargement des réservations");
    };
    xhr.send();
}



        displayReservations(reservations) {
          reservations.forEach((reservation) => {
            const arrivee = new Date(reservation.date_arrivee);
            const depart = new Date(reservation.date_depart);

            // Parcourir tous les jours entre arrivee et depart
            for (
              let d = new Date(arrivee);
              d < depart;
              d.setDate(d.getDate() + 1)
            ) {
              const dayElement = document.querySelector(
                `[data-date="${d.toISOString().split("T")[0]}"]`
              );
              if (dayElement) {
                const reservationElement = document.createElement("div");
                reservationElement.className = `reservation chambre-${reservation.idChambre}`;
                reservationElement.title = `${reservation.type_chambre} - ${reservation.prenom} ${reservation.nom}`;
                reservationElement.textContent = `Ch. ${reservation.numeroChambre}`;
                dayElement.appendChild(reservationElement);
              }
            }
          });
        }

        renderChambreSelection() {
          const container = document.getElementById("chambre-selection");
          container.innerHTML = this.chambres
            .map(
              (chambre) => `
                    <div class="chambre-card" data-id="${chambre.idChambre}" onclick="calendar.selectChambre(${chambre.idChambre})">
                        <h4>Chambre ${chambre.numeroChambre}</h4>
                        <p>Type: ${chambre.type_chambre}</p>
                        <p>Capacité: ${chambre.capacite} personnes</p>
                        <p>Prix: ${chambre.prix_nuit}€/nuit</p>
                    </div>
                `
            )
            .join("");
        }

        selectChambre(chambreId) {
          const card = document.querySelector(`[data-id="${chambreId}"]`);
          if (card.classList.contains("unavailable")) return;

          const index = this.selectedChambres.indexOf(chambreId);
          if (index > -1) {
            this.selectedChambres.splice(index, 1);
            card.classList.remove("selected");
          } else {
            this.selectedChambres.push(chambreId);
            card.classList.add("selected");
          }

          this.updateSubmitButton();
        }

        updateSubmitButton() {
          const submitBtn = document.getElementById("submit-btn");
          submitBtn.disabled = this.selectedChambres.length === 0;
        }

        setupEventListeners() {
          document
            .getElementById("reservation-form")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              this.submitReservation();
            });
        }

        submitReservation() {
          const formData = {
            nom: document.getElementById("nom").value,
            prenom: document.getElementById("prenom").value,
            email: document.getElementById("email").value,
            telephone: document.getElementById("telephone").value,
            adresse: document.getElementById("adresse").value,
            date_arrivee: document.getElementById("date-arrivee").value,
            date_depart: document.getElementById("date-depart").value,
            nombre_personnes: document.getElementById("nombre-personnes").value,
            commentaire: document.getElementById("commentaire").value,
            chambres: this.selectedChambres,
          };

          const xhr = new XMLHttpRequest();
          xhr.open('POST', 'reservation.php', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          
          xhr.onreadystatechange = () => {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                try {
                  const result = JSON.parse(xhr.responseText);
                  if (result.success) {
                    this.showConfirmation(result.reservation_id);
                    this.resetForm();
                    this.loadReservations();
                  } else {
                    alert("Erreur: " + result.error);
                  }
                } catch (error) {
                  console.error("Erreur parsing réponse:", error);
                  alert("Erreur lors de la réservation");
                }
              } else {
                alert("Erreur réseau lors de la réservation");
              }
            }
          };
          
          xhr.onerror = () => {
            alert("Erreur réseau lors de la réservation");
          };
          
          xhr.send(JSON.stringify({
            action: "create_reservation",
            data: formData
          }));
        }

        showConfirmation(reservationId) {
          document.getElementById(
            "confirmation-message"
          ).textContent = `Votre réservation #${reservationId} a été créée avec succès!`;
          document.getElementById("reservation-modal").style.display = "flex";
        }

        resetForm() {
          document.getElementById("reservation-form").reset();
          this.selectedChambres = [];
          this.renderChambreSelection();
          this.updateSubmitButton();
        }

        changeMonth(direction) {
                this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                this.generateCalendar();
                this.loadReservations();
        }

        goToToday() {
                this.currentDate = new Date();
                this.generateCalendar();
                this.loadReservations();
        }
    }
/***********************************Fonctions globales ******************************************
************************************************************************************************/    
let calendar;

function differenceEnJours(date1, date2) {
    const unJour = 1000 * 60 * 60 * 24; // milliseconds dans un jour
    
    // Normaliser les dates à minuit
    const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
    const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
    
    const differenceMs = d2.getTime() - d1.getTime();
    return Math.round(differenceMs / unJour);
}

const aujourdhui = new Date();
const autreDate = new Date('2023-12-05');

function differenceEnJours(date1, date2) {
    const unJour = 1000 * 60 * 60 * 24; // milliseconds dans un jour
    
    // Normaliser les dates à minuit
    const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
    const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
    
    const differenceMs = d2.getTime() - d1.getTime();
    return Math.round(differenceMs / unJour);
}




  async function checkAvailability() {
    const dateArrivee = document.getElementById("date-arrivee").value;
    const dateDepart = document.getElementById("date-depart").value;
        
    if (!dateArrivee || !dateDepart) {
    alert("Veuillez sélectionner les dates");
    return;
    }

     if (dateArrivee > dateDepart) {
     alert("Dates illogiques");
     return;
     }

    const aujourdhui = new Date();
    const Darrivee = new Date(dateArrivee);
    const Ddepart = new Date(dateDepart);

    const joursDifference = differenceEnJours(aujourdhui, Darrivee);

    if (joursDifference < 0) {        
    alert("Dates passees");
          return;
    }

    const joursDifference2 = differenceEnJours(aujourdhui, Ddepart);

    if (joursDifference2 < 0) {
      alert("Dates passees");
          return;
    }

    
        try {
        const response = await fetch(
            `reservation.php?action=check_availability&date_arrivee=${dateArrivee}&date_depart=${dateDepart}`
        );
        if (!response.ok) {
            throw new Error(`Erreur HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Vérifier si c'est une erreur
        if (data.error) {
            throw new Error(data.error);
        }
        
        const availableChambres = data;
          //const availableChambres = await response.json();

          const resultDiv = document.getElementById("availability-result");
          const chambreCards = document.querySelectorAll(".chambre-card");

          // Réinitialiser l'affichage
          chambreCards.forEach((card) => {
            card.classList.remove("unavailable", "selected");
          });

          if (availableChambres.length > 0) {
            resultDiv.className = "availability-result available";
            resultDiv.innerHTML = `<strong>Chambres disponibles:</strong> ${availableChambres.length} chambre(s) trouvée(s)`;
            resultDiv.style.display = "block";

            // Marquer les chambres non disponibles
            const availableIds = availableChambres.map((ch) => ch.idChambre);
            chambreCards.forEach((card) => {
              const chambreId = parseInt(card.dataset.id);
              if (!availableIds.includes(chambreId)) {
                card.classList.add("unavailable");
              }
            });
          } else {
            resultDiv.className = "availability-result unavailable";
            resultDiv.innerHTML = "Aucune chambre disponible pour ces dates";
            resultDiv.style.display = "block";
            chambreCards.forEach((card) => card.classList.add("unavailable"));
          }
        } catch (error) {
          console.error("Erreur vérification disponibilité:", error);
        }
      }

      function reserver() {document.location.href="http://localhost/hotel/formulaire.html";}


      function closeModal() {
        document.getElementById("reservation-modal").style.display = "none";
      }

      function changeMonth(direction) {
        calendar.changeMonth(direction);
      }

      function goToToday() {
        calendar.goToToday();
      }

      // Initialisation
      document.addEventListener("DOMContentLoaded", () => {
        calendar = new ReservationCalendar();
      });
    </script>
  </body>
</html>
